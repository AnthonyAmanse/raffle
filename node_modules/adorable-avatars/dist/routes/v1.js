'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _express = require('express');

var _imageFiles = require('../lib/imageFiles');

var _slotMachine = require('../lib/slotMachine');

var _slotMachine2 = _interopRequireDefault(_slotMachine);

var _imager = require('../lib/imager');

var _common = require('./common');

var _common2 = _interopRequireDefault(_common);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var imageFiles = (0, _imageFiles.allPaths)();
var imageSlotMachine = new _slotMachine2.default(imageFiles);

// eslint-disable-next-line new-cap
var router = (0, _express.Router)();

router.param('id', function (req, res, next, id) {
  var image = imageSlotMachine.pull(id);
  req.imagePath = image;
  next();
});

router.get('/:id', function (req, res) {
  res.sendFile(req.imagePath);
});

// with custom size
router.get('/:size/:id', function (req, res, next) {
  (0, _imager.resize)(req.imagePath, req.params.size, function (err, stdout) {
    _common2.default.sendImage(err, stdout, req, res, next);
  });
});

exports.default = router;